/*--------------------------------------------------------------
                main.c
  
PIC16F877A 4MHZ Clock

Caio Rodrigues Soares Silva

	Testador de motor de passo, programa para descobrir a sequência de fios de
motor de passo unipolar.

	




--------------------------------------------------------------*/


/* Processador de arquivo de cabeçalho */

#define clock4mhz
#define __16f877a

#include "pic16f877a.h"
#include "commdefs.h"
#include "delay.h"
//#include "adc.h"


typedef unsigned int config;


config at 0x2007 __CONFIG= 
_WDT_OFF &		// Sem Watch dog timer 
_PWRTE_ON & 	// Com Power-On Reset
_BODEN_OFF &	// Com
_CP_OFF & 	    // Sem proteção do código
_DEBUG_OFF & 	// Sem debugger
_HS_OSC & 		// Oscilador cristal 4 MHZ
_CPD_OFF & 		//
_LVP_OFF; 		// Sem LVP:Low Voltage Programmming


//Número de passos do motor de passos de 5 fios, 1 POWER e 4 Bobinas
#define NUMSTEPS	4
//#define debug1

__code u8 step[NUMSTEPS]={1,2,4,8};  //Armazenado na memória flash já que é constante
u8 setPos=0;
u8 i;							   //Contador do passo


void main(){


		CMCON=7;		  // Desabilita comparadores analógicos
		ADCON0=6;		  // Todas entradas analógicas desabilitadas
		INTCON=0;		  //Sem interrupção


#ifndef debug1
		PORTB=0;		  //Limpa os latchs
		TRISB=0;		  //Seta o Porto B como saída
	
		PORTB=0xFF;


		while(1){/*Loop Para sempre*/
           
		
				for(i=0;i<NUMSTEPS;i++){
//						setHighNibble(PORTB,step[i]);
//						 PORTB=PORTB&0x0F|(step[i]<<4);
						PORTB=step[i] | 0xF0;
						delay_ms(20);
				}//End of for
				


		}//End of while
#else


		TRISB=0x00;
		TRISA=0X00;
		TRISD=0x00;
		TRISC=0x00;

		PORTA=0XFF; PORTB=0XFF; PORTD=0XFF; 
		PORTC=0XFF;
	
		while(1);
#endif



} //end of main

/*----------------------------------------------------------*/





/*------------------------------------------------------------------
 ---------------------  END OF FILE --------------------------------
 ------------------------------------------------------------------*/
