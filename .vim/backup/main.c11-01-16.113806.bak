/*			main.c
 *
 *
 *
 **/


#define pic16f877a
#define clock4mhz 

#include "pic16f877a.h"
#include "default.h"
#include "delay.h"

/**
 *@file main.c
 *@brief Teste da interface serial UART entre o PIC e o terminal(PIC-KIT2)
 *
 *
 *@author Caio Rodrigues Soares Silva
 *
 *
 *@warning It's still under development.Unstable.
 *
 */



/*
 *    |--------------------------------------------+
 *    |           CONFIGURATION BITS               |
 *    |                                            |
 *    +--------------------------------------------+
 */


typedef unsigned int config;

config __at 0x2007 __CONFIG= 
_WDT_OFF &    // Sem Watch dog timer 
_PWRTE_ON &   // Com Power-On Reset
_BODEN_OFF &  // Com
_CP_OFF &       // Sem proteção do código
_DEBUG_OFF &  // Sem debugger
_HS_OSC &     // Oscilador cristal 4 MHZ
_CPD_OFF &    //
_LVP_OFF;     



/*
 *    |--------------------------------------------+
 *    |    DECLARAÇÃO DAS ROTINAS                  |
 *    |                                            |
 *    +--------------------------------------------+
 */

void delay_ms(u8 sec);
void sendchar(char x);



/*
 *    |--------------------------------------------+
 *    |           MAIN                             |
 *    |                                            |
 *    +--------------------------------------------+
 */
void main(void){


    /*      
     *          1.0 Cconfiguração da UART 
     *  
     *    Modo assincrono 9.6 Kbauds , Oscilador 4 MHZ
     *
     */

    /* 1.1  Configuração dos PINOS DA UART*/
    TRISC7=1; TRISC6=1;

    /* 1.2 Modos de Transmissão e Recepção*/
    TX9=0;                      // Seleciona transmissão de 8 bits
    SYNC=0;                     // Modo Assíncrono de transmissão
    RX9=0;                      // Recepção de 8 bits

    /* 1.3  Configuraçao do Baud Rate */
    SPBRG=25; BRGH=1;           // Configura em 9.6 Kbauds , em um oscilador de 4 MHZ

    /*1.4 Ativação do UART */
    TXIE=0;                    // Interrupção de envio desativad
    RCIE=0;                    // Interrupção de recepção desativada
    TXREG=0x00;                 // Inicializa registro
    TXEN=1;                     // Transmissão contínua habilitada 
    CREN=1;                     // Transmissão contínua habilitada
    SPEN=1;                     // Seta RC7/RX/DT e RC6/TX/CK como portas seriais

    
                            
    delay_ms(250);              // Delay de 500 ms para estabilizar a UART
    delay_ms(250);


    ///////////////////////////////////////
    // Fim da configuração do UART      ///
	///////////////////////////////////////


    TRISB=0X00; // Acende todos leds do Porto B
    PORTB=0XFF; 


   	while(TRUE) {

        // Se funcionar imprimirar caio continuamente no terminal
        sendchar('c');
        sendchar('a');
        sendchar('i');
        sendchar('o');

	}//Endwhile

		
}//Endmain




void sendchar(char x){
    while(!TXIF); // Espera o buffer estar pronto(vazio) 
                  //para enviar o caracter

    TXREG=x;      // Transmite o caracter
} // End of SendChar

///////////////////////////////////////////////////////////
//                      END OF FILE                      //
///////////////////////////////////////////////////////////
