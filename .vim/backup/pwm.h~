#ifndef __PWM_H__
#define __PWM_H__


#include <pic18fregs.h>
#include "default.h"



#define portCCP1  TRISC
#define pinCCP1   2 


#define presc01T2   0
#define presc04T2   1     
#define presc16T2   3



void  startPWM1(){	CCP1CON|= 0X0F; }
void  stopPWM1(){	CCP1CON&= 0XF0; }



/// \name  setPWM1
/// \brief Set PWM module 1 
/// It configures the mcu to provides PWM1,but the 
/// PWM frequency must be set by tuning the timer 2 prescaler
/// and pr2 the PR2 value
///
void setPWM1( u8 presc , u8 pr2 ){

	// Set CCP1 pin as output      
	clrb(portCCP1,pinCCP1); 

	// Set PWM frequency and turn TIMER2 ON
	PR2=pr2 ; 
	T2CON  = 0XF4 | presc;

	// PWM off and Duty Cycle=0
	CCP1CON=0;
	CCPR1L=0;
	TMR2=0xFF;
}


void setPWM1dc( u16 duty ){
	u16 tmp;
	tmp =duty>>2;
	CCPR1L = tmp;
	tmp  =  ((duty & 0x03 ) << 4);
	CCP1CON=  CCP1CON | ((u8) tmp) ;
}










#endif



                             



