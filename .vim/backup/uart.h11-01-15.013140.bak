/*
 * =====================================================================================
 *
 *       Filename:  uart.h
 *
 *    Description:  Biblioteca para uso da UART
 *
 *        Version:  1.0
 *        Created:  01/14/2011 08:10:17 PM
 *       Revision:  none
 *       Compiler:  gcc
 *
 *         Author:  YOUR NAME (), 
 *        Company:  
 *
 * =====================================================================================
 */
#ifndef _uart_h_
#define _uart_h_

#include "default.h"
#include "delay.h"
  	/*		Especial characters	predefinition from ASCII table	*/
  	#define NULL_char		0x20
  	#define BACKSPACE_char	0x08
	#define RETURN_char		0x0d

/*

Configuring the USART:
OpenUSART(USART_TX_INT_OFF &
USART_RX_INT_OFF &
USART_ASYNCH_MODE &
USART_NINE_BIT &
Configure USART
USART_CONT_RX &
for Asynchronous
USART_BRGH_HIGH,
I/O
32);


OpenUSART(USART_TX_INT_OFF &
USART_RX_INT_OFF &
USART_ASYNCH_MODE &
USART_NINE_BIT &
USART_CONT_RX &
Must specify the setting
USART_BRGH_HIGH,
for BRGH and the
value for SPRRG to
32);


obtain the desired
baud rate


 
 */




  	      	
/*
 *      |--------------------------------------------+
 *      |           initUSART                        |
 *      |                                            |
 *      +--------------------------------------------+
 */



void initUART(u8 SBPRG_,u8 BRGH_){

    /* 1.1  Configuração dos PINOS DA UART*/
    TRISC7=1; TRISC6=1;

    /* 1.2 Modos de Transmissão e Recepção*/
    TX9=0;                      // Seleciona transmissão de 8 bits
    SYNC=0;                     // Modo Assíncrono de transmissão
    RX9=0;                      // Recepção de 8 bits

    /* 1.3  Configuraçao do Baud Rate */
    SPBRG=SBPRG_; BRGH=BRGH_;           // Configura em 9.6 Kbauds , em um oscilador de 4 MHZ

    /*1.4 Ativação do UART */
    TXIE=0;                    // Interrupção de envio desativad
    RCIE=0;                    // Interrupção de recepção desativada
    TXREG=0x00;                 // Inicializa registro
    TXEN=1;                     // Transmissão contínua habilitada 
    CREN=1;                     // Transmissão contínua habilitada
    SPEN=1;                     // Seta RC7/RX/DT e RC6/TX/CK como portas seriais
    
    delay_ms(250);              // Delay de 500 ms para estabilizar a UART
    delay_ms(250);
}


#if 1
void sendchar(char x){
    while(!TXIF); // Espera o buffer estar pronto(vazio) 
                  //para enviar o caracter

    TXREG=x;      // Transmite o caracter
} // End of SendChar
#endif


#define newline()	sendchar(RETURN_char);

// Imprime caracter na USART
void prints(pchar msg ){

		while(*msg) {
				sendchar(*msg); 	//	 Só saí do loop quando *msg=0
									// quando encontra caracter nulo
				msg++;				// Vaí ao próximo caracter
		}
} // end of prints



#endif
///////////////////////////////////////////////
//			END OF FILE: uart.h				///
///////////////////////////////////////////////
