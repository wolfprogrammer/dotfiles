function I=ipv(V,T,S)

%Working conditions
%T=25
%S=1.0        # Radiação incidente em W/m2
%V=0:21

T=T+273
% constants



K = 1.38e-23; % Boltzman’s const
q = 1.60e-19; % charge on an electron

Tr=25+273  % Reference temperature

model="msx60i"

dbstop();

Vocc=21.06 
Isc=3.80
Vmp=17.1
Imp=3.5
Pm=60
NOCT=47          % Normal Operating Cell temperature ( 20ºC / 800 W/m2 / 1 m/s wind speed)
a1= 0.00065      % (%/K)    Temperature coefficient of short circuit current
a2= -80e-3       % mv/ºC    Temp coef of Open Circuit Voltage
a2=a2/Vocc       % %/ºC
a3= -0.5         % %/ºC        Temp coef of  Power NOCT2


% Temperatura da célula dada a temperatura do ar T (ROSS,1980) 
Tcell=T+(NOCT-20)/800*S


n = 1.2;	% "diode quality" factor, =2 for crystaline, <2 for amorphous
Eg = 1.12; 	% band gap voltage, 1.12eV for xtal Si,  ̃1.75 for amoriphous Si.
Ns = 36;	% number of series connected cells (diodes)
Np =  1;        % Number of parallels connected cells


Voc=Vocc/Ns	% Tensão de circuito aberto por célula

Vt=n*K*T/q	% Tensão térmica

% Corrente que depende da irradiação incidente
Iph=(Isc+a1*(T-Tr))*S



%-----------------------------------------------
%         Cálculo de Rs e Rp por vários modos  %
%                                              %
modo=2
switch modo
	case 1
	% Estimativa inicial  (Resistência equivalente do painel)
        % Rs por célula
	Rs=0.008
	Rp=1000
       
	case 2
	% Rs total

	Irr=(Isc)/(exp(q*Voc/(n*K*Tr))-1)   % (SEGUEL,2009,p187)
	dVdI_Voc= -1.15/Ns/2  % Extraido do grafico (modo 2)


	% Francisco M. González-Longatt  - Model of Photovoltaic Module in Matlab™
	% 2DO CONGRESO IBEROAMERICANO DE ESTUDIANTES DE INGENIERÍA ELÉCTRICA, ELECTRÓNICA Y COMPUTACIÓN  (II CIBELEC 2005)
	Xv=Irr*q/(n*K*Tr)*exp((q*Voc)/(n*K*T))
	Rs= -dVdI_Voc-1/Xv

	Rp=1e3     % Valor estimado
	
	case 3
	
	


	otherwise
end

%Rstot= Np/Ns*Rs
%Rptot= Np/Ns*Rp 


% Corrente de saturação reversa da célula a 25ºC padrão STC
%Irr=(Isc-Voc/Rp)/(exp(q*Voc/(n*K*Tr))-1)   % (SEGUEL,2009,p187)
%Irr=(Isc)/(exp(q*Voc/(n*K*Tr))-1)   % (SEGUEL,2009,p187)


% Corrente de saturação reversa da célula a T ºC
Ir=Irr*(T/Tr)^(3/n)*exp(q*Eg/(n*K)*(1/Tr-1/T))

%  Resolução pelo método de Newton Raphson
I=zeros(size(V));
Vc=V/Ns  % tensão por célula em série

                           
for i=1:10
	f=-I+Iph-Ir*(exp((Vc+I*Rs)/Vt)-1) -(Vc+I*Rs)/Rp
	df=-1-Ir*exp((Vc+I*Rs)/Vt)*Rs/Vt-Rs/Rp
        I=I-f/df
end

%{
for i=1:8
	f=-I+Iph-Ir*(exp(q*(Vc+I*Rs)/(n*K*T))-1) -(Vc+I*Rs)/Rp
	df=-1-Ir*exp(q*(Vc+I*Rs)/(n*K*T))*(q*Rs)/(n*K*T)-Rs/Rp
        I=I-f/df
end
%}




%{
  References:
  
Seguel, J. I. L. (2009). Projeto de um sistema fotovoltaico 
autônomo de suprimento de energia usando técnica MPPT e controle digital.

Ross, R.G. (1980) "Flat-Plate Photovoltaic Array Design Optimization", 
Conference Record, 14th IEEE Photovoltaic Specialists Conference, San Diego, pp. 1126-1132.


http://www.posharp.com/photovoltaic/panelefficiency/database.aspx 
Preal = Pm * S / 1000 * [1 - λ(Tcell - 25)]
Tcell = Tambient + S / 800 * (TNOCT - 20) 



Model of a photovoltaic panel emulator
in Matlab-Simulink
Yrd. Doç. Dr. HAYRETTİN CAN1
Department of Computer Science, Engineering Faculty, Firat University, 23119, Elazig, Turkey
E-Mail: hcan@firat.edu.tr



Normas:
-----------------------------------------------
NEC 690.53
NEC Article 690.7

IEC 61215 (crystalline silicon performance), 
IEC 61646 (thin film performance), 
IEC 61730 ((crystalline modules, safety), 
IEC 62108(concentrating PV performance), 
IEC 61701 (salt resistance) ) for Europe
UL 1703, UL 8703 (CPV) for USA and Canada


APUD
2011 International Conference on Signal, Image Processing and Applications
With workshop of ICEEA 2011
IPCSIT vol.21 (2011) © (2011) IACSIT Press, Singapore
Modeling of Operation of Solar PV Module under Practical 
Conditions in MATLAB 
K.Jayachandran
1+
, A.K.Tiwari
1
, N.R.Raje
1
, O.S.Sastry
2 
1
Center for Alternate Energy Research, University of Petroleum and Energy Studies, Dehradun 
2
Solar Energy Center, Ministry of New and Renewable Energy,New Delhi 


Gerald Kunz, Andres Wagner “Internal series resistance determinate of only oneIV curve under illumination” 
19th European Photovoltaic Solar energyconference ,Paris, France. 

Andreas wagner “Peak-power and internal series resistance measurement undernatural ambient conditions” 
Eurosun 2000 Copenhagen. 


%}










