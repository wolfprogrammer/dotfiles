
%	Projeto de conversor BUCK
% Para sistema MPPT
%
%	A fazer
%  1. Projetar o divisor de tensão com mínima perda de potencia para 5V
%  2. Selecionar diodo adequado e verificar efeito de diodo
%  3. Selecionar Capacitor Ok
%  4. Selecionar Indutor e ver qual o padrão de mercado
%  5. Projetar aplificador do resistor shunt
%
%  2. Comprar um resistor shunt 
%
%

units;


Pmax=20  	% W maxima potência do painel
Vin2=21	 	% V Máxima tensão do painel Voc
Vin1=13  	% V Mínima tensão para o conversor buck operar
Vo=12    	% V tensão de saída da bateria
Iimax=2        % 1.35 Corrente de curto circuito (Máxima corrente do painel)


%-------------
% Requisitos
%
f=200	% kHz Frequência de chaveamento
ri=10 	% Ripple de corrente em %
rv=1    % Ripple de tensão em %



%---------------------%
%  Cálculos
%

f=f*1000;
ri=ri/100
rv=rv/100
Io=Pmax/Vo % Corrente de saída

di=ri*Io       % Ondulação de corrente
dv=rv*Vo       % Ondulação de tensão

IL=Io

ILmax=IL+di/2
ILmin=IL-di/2

D1=Vo/Vin1
D2=Vo/Vin2
Dmin=min(D1,D2)

% Mínimo indutor 
Lmin=Vo*(1-Dmin)/(di*f)
Cmin=di/(8*dv*f)
L=Lmin
C=Cmin


% Mínima corrente para haver modo CCM
Iomin1=D1*(Vin1-Vo)/(2*L*f)
Iomin2=D2*(Vin2-Vo)/(2*L*f)
Iomin=max(Iomin1,Iomin2)
Rmax=Vo/Iomin

disp('Valores do capacitor e indutor')
L_uH=L/uH
C_uF=C/uF
 
%------------------------------------------------%
% DIMENSIONAMENTO DO SENSOR DE CORRENTE E TENSÃO %
%                                                %
disp('')
disp('Dimensionamento de outros componentes')

disp('Resistor  shunt para medição de corrente');
Imax=Iimax      % A 	Máxima corrente a ser medida
Pd=0.5 		% W 	Máxima potência dissipada
Rs=Pd/Imax^2    % Ohm   Máximo valor da resistência shunt
Rs_mohm=1e3*Rs	% mOhm


%---------------------------------------------------
%  RESITORES DOS DIVISORES DE TENSÃO
%        VIN
%        |             VREF=R2/(R2+R1)*Vin
%	|_|  R1
%        |---->> Vref TO MCU/ADC
%	|_|  R2
%        |
%        GND
disp('Resistores de medição de tensão')
% Resistores em KOhm
% Resitor do painel solar
disp('Resistor do painel solar')
ADCmax=1024 % 10 bits
Vref=[1 2 3 4 5]
R2=10	
Vinp=Vin2
R1=(Vinp./Vref-1)*R2
resol= Vref/ADCmax*1e3  %  mV/bit

%teste
volts=linspace(0,Vin1,100)

idx=1;
ADC=zeros(length(volts),length(Vref))
for R= R1    
	R
	V=volts*R2/(R2+R)
        ADC(:,idx)=round(V/Vref(R1==R)*ADCmax)
	idx=idx+1
end





