# 
# Makefile for sdcc
# 
# Compiler : sdcc
#
#

#
#---------------------------------------------------
#	Nome do código hex a ser quimado no MCU
#firmware do pic será firmware.hex 
#
PRJ		= firmware
#
#-------------------------------------------------
#	Código fonte
#
SRCC= main
SRC = $(SRCC).c
#
#---------------------------------------------
#	Diretório onde estão os arquivos fontes 
#
#PACKAGEDIR	= pr1
#
#---------------------------------------------------
#	Tipo de CPU usada
CPU		= 16f877a
#
#--------------------------------------------------
#	Arquitetura , core 14 bits ou core 16 bits
#
ARCH	= -mpic14
#
#-------------------------------------------------------
#		Definições das ferramentas usadas para compilar
#
CC		= sdcc 
GPASM 	= gpasm
GPDASM	= gpdasm
GPLINK	= gplink
#
#---------------------------------------------------------
# Flags do SDCC compilaçao
#
#  -c :compile only
#  -S :stop after assembly
#  -V : show actual command line the compiler executing
#  --verbose: Shows the various actions the compiler is performing
##
CFLAGS	= --debug -V --verbose  $(ARCH) -p$(CPU)
#
#--------------------------------------------------
#	Data atual do sistema
#
DATETIME  = $(shell date +%Y_%m_%d_%H%M%S)
#
#
#--------------------------------------------------------
# 		Alvo principal/Main Target
#
#all: $(PRJ).hex
#
#--------------------------------------------------------
#		Compilar todos códigos fontes
#
$(PRJ).hex: $(SRC)
	$(CC) $(CFLAGS) $(SRC)
	@mv $(SRCC).hex $(PRJ).hex 
	@echo ""
	@echo "***** Compilação terminada ********"
#
#
#-------------------------------------------------------
#		Fazer snapshot do projeto
#
dist:
	@tar --exclude=*.tar.gz --exclude=./dists  --ignore-failed-read -zcvf \
		./dists/$(PRJ)-$(DATETIME).tar.gz ./$(PAKAGEDIR); 
	@echo "**** Snapshot Criado: $(PRJ)-$(DATETIME).tar.bz2 ******"


#-----------------------------------------------------
#
#
clean:
	rm *.asm *.hex *.lst *.cod *.o *.p *.adb
#
#------------------------------------------------------
#		
#
cleandist:
	rm -rf ./dists/*.tar.gz
